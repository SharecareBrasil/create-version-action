name: 'Create release'
outputs:
  tag:
    description: "release tag"
    value: "v${{ steps.create-release.outputs.version }}"

runs:
  using: "composite"
  steps:
  - uses: actions/setup-node@v3
    with:
      node-version: 15
  - name: install dependencies
    shell: bash
    run: |
      rm yarn.lock
      yarn add semantic-release@19
      yarn add @semantic-release/changelog
      yarn add @semantic-release/error
      yarn add @semantic-release/git
      yarn add @semantic-release/release-notes-generator
      yarn add @semantic-release/github
      yarn add @semantic-release/commit-analyze
      yarn add commit-analyzer-fail-on-no-release
      yarn add conventional-changelog-conventionalcommits
  - name: download .releaserc
    shell: bash
    run: |
      if [[ ! -f ".releaserc.json" ]] ; then curl -O https://raw.githubusercontent.com/SharecareBrasil/create-version-action/main/.releaserc.json ; fi
  - name: Release
    shell: bash
    id: create-release
    run: |
      npx semantic-release
      VERSION=$(cat package.json|jq -r .version)
      echo "version=$VERSION" >> $GITHUB_OUTPUT
    env:
      GITHUB_TOKEN: ${{ github.token }}
